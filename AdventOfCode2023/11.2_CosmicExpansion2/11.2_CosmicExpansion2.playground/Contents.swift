import UIKit

class CosmicExpansion2 {
    
    var shortInput: String {
        let input =
        """
        ...#......
        .......#..
        #.........
        ..........
        ......#...
        .#........
        .........#
        ..........
        .......#..
        #...#.....
        """
        return input
    }
    var longInput: String {
        let input =
        """
        ...................#.....#...............#......................#......................#...................#...........................#....
        ..................................................#................................................#..............#.........................
        ......#.....#.................#..............................................................#..............................................
        ......................................................#..................#.....#............................................................
        .....................................................................................#.....................................#................
        .#............................................................................................................#.............................
        ..................#......................#............................#..............................................................#.....#
        ......................................................................................................#.............#.......................
        ..............................................#........#........................#................................................#..........
        .....#......................#......................................#.....#...................#..............................................
        .........................................................................................................#..................................
        ......................#...............#............#........................................................................................
        ..................................................................................................#.........................................
        ..........#..................................................................................................#..............#..........#....
        ....#...........................#..........................#..............................#.................................................
        ........................................#............................................#.................................#.........#..........
        ...................................................................#...........#..........................#.................................
        ............................................................................................................................................
        ............................................#...............................................................................................
        ....................#.................................#................................................................................#....
        ............................................................................................#...............................................
        ............................................................................#........#.........................................#............
        ...#...................#..........................#...............#......................................................#..................
        ..............................#........#....................................................................................................
        ................#................................................................................#.......................................#..
        ......#..............................................................#...................#..................................................
        .#.........................................#..........#.........#..............#........................#............#......................
        ............................................................................................................................................
        ...........#...................................#...............................................................#.............#..............
        ........................#........#........................................#..........#..................................................#...
        ....#.....................................................#.................................#......................................#........
        ...............................................................#...................................#....................#...................
        #.............................................................................#..................................#.............#............
        .............................#..........#.............................#...................................#.................................
        ........................................................#...................................................................................
        .............#........................................................................................................#................#....
        ...#.............................................#..................................#......#.....#..........................................
        ................................#..............................#............................................................................
        ...................#........................................................#...............................................................
        #..........................#.........................................................................#......#...........#...................
        .......#...........................#.....#..............#.................................................................................#.
        ......................#.........................#...........................................................................................
        .....................................................................................................................#.......#......#.......
        .............................................................#....................#...............#.........................................
        .........#..................................................................................................................................
        ...............................#............#....................#.....#...............#..................#.................................
        ....#...........#.........#.........................#..............................................................#..................#.....
        .....................#.......................................................................#..............................................
        ....................................................................................................#.......................................
        .....................................#..........#...............................#...........................#..........#..........#.......#.
        ..........................................................................................#.................................................
        .#..........................................#.............................#.................................................................
        .................#...........#............................#.............................................#......................#............
        .........#...........................................................#..............#.......................................................
        ..................................................................................................#.............#.......#...................
        .............................................................................#.......................................................#......
        ......#.............#...........#..........#........#...........#...........................................#...............................
        .........................................................................#..................................................................
        ........................................................#...........#...........#................................................#..........
        ........................................#....................#..........................................#.............#.....................
        ..........#...................#................................................................#..........................................#.
        ..................#.................................................................................#..........#............................
        ..........................................................................................#.................................................
        ..........................................................#...............#.................................................................
        ............#................................#......................#..........#.........................................#......#...........
        ..#.......................#..................................................................................#.....#........................
        .................................................#...........................................#..............................................
        .........#........#..................#...........................#.....................#...............#.............................#......
        ......................................................................#..........................#.....................#....................
        ............................................................................................................................................
        ........................#.....................................................................................#............#............#...
        ..............#............................#.................................#......#.......................................................
        ........#..........#........................................................................................................................
        ............................#............................................#..........................#.......................................
        .......................................................#......#.........................................................#......#............
        .........................................................................................#.....#..................#.........................
        .......................#................#.......................................#............................#.......................#......
        ............................................................................................................................................
        .........#.......................................................................................................................#..........
        ...#..........#................................#...........#......#.....................................................................#...
        ....................................................................................#.......................................................
        .............................#.....................................................................................#.....#..................
        ...................................#.....................................................#.............#....................................
        .....#.............#................................#......................................................................................#
        .............#............................................#...................#.................#.....................#.....#......#........
        #...............................#.........#..........................................#......................................................
        .........................#...............................................#..................................................................
        .................................................................................#......................................................#...
        ....#...........#..................................#......................................................#.................................
        ..............................................#.....................#.......................#...........................#...................
        ..............................#.........................#.............................................#.........#...........................
        .........................................#.....................................#...............................................#............
        .#.........#..................................................#..........................#...........................#......................
        ............................................................................................................................................
        .........................................................................................................................................#..
        .......#..........................................#.......................#................................................#........#.......
        ............................................................................................................................................
        .................#.........#.........................................#.........................#.....#......#...............................
        ............................................#..........#......................#......#......................................................
        ....................................#.............................................................................#.........................
        ...........................................................#................................................................................
        .................................................................................#........#...............#..............................#..
        .......#...........#..............................#.........................................................................................
        ..#...............................................................................................#.................#............#..........
        ..............................................#..........#...............#..................................................................
        ..................................#.....#.....................#.......................#...............#......#.............#................
        ..........................#.................................................................................................................
        ....................................................#..................................................................#....................
        ...........................................................................#..............#.....#...........................................
        #...................#...........................................................#...........................................................
        ...........................................#....................#....................................................................#......
        .......#.....#........................................#....................................................#................................
        ..............................#...................................................................#.........................................
        .............................................................................#.......................................#......................
        .....................#....................................................................................................................#.
        .................................#....................................#........................#............................................
        ......#...........................................#.........................................................................................
        ...........................................#................................................................................#......#........
        ..........#...............#.........................................................#.......................................................
        ..................#...........................................................#.............................................................
        ...............................................................#............................................#.......#.......................
        ....#........#...................................................................................#..........................................
        ......................#...................................................#...........#................#....................................
        ........#..............................................#...................................#....................#...........................
        ..................................................#.......................................................................#..........#......
        .#...................................#..........................................................................................#...........
        ..........................................#........................................#...............#........................................
        ..........................#.....#........................................................................................................#..
        ..................#...........................#..........#...........................................................#......................
        ...................................................#......................#...................................................#.............
        .........#................................................................................#.................................................
        ..............#................................................................#............................................................
        ...........................#.........#..............................#...................................#..........#....................#...
        ..................................................................................................#.............................#...........
        ..#..............................................#..........................................................................................
        .................#.....................................................#.................#..................................................
        .................................#.........#...................................................#......#.........#...........................
        ..........#.........................................#.....#......................#..........................................................
        ....................#..........................#................#...........................................................#......#........
        #........................#.............#..................................#.................................#...............................
        """
        return input
    }
    
    func sumOfShortestWays(input: String, multiplyerOfTheEmtyRowOrColumn: Int) -> Int {
        var sum: Int = 0
        
        //
        var lines: [String] = input.components(separatedBy: "\n")
        var grid: [[Character]] = []
        
        // MARK: - Get Grid with marked empty Rows and add their indices to the array
       
        var emptyRowsIndices: [Int] = []
        var emptyColumnsIndices: [Int] = Array<Int>(0...(lines[0].count - 1))
                
        for line in lines {
            let row = Array(line)
            if row.contains("#") {
                grid.append(row)
                for i in 0...(row.count - 1) {
                    if row[i] == "#" && emptyColumnsIndices.contains(i) {
                        emptyColumnsIndices.removeAll { $0 == i }
                    }
                }
            } else {
                let markedRow: [Character] = Array<Character>(repeating: "$", count: row.count)
                grid.append(markedRow)
                emptyRowsIndices.append((grid.count - 1))
            }
            
        }
        
        // MARK: - Get the real Grid and add marked columns indices to the array
        
        var realGrid: [[Character]] = []
        
        for row in grid {
            var newRow = row
            for emptyColumnIndex in emptyColumnsIndices{
                newRow.remove(at: emptyColumnIndex)
                newRow.insert("$", at: emptyColumnIndex)
            }
            realGrid.append(newRow)
            
        }
        
        // MARK: - Indices of all the "#"-characters
        
        var allGalaxies: [[Int]] = []
        
        for (rowIndex, row) in realGrid.enumerated() {
            for (columnIndex, column) in row.enumerated() {
                if column == "#" {
                    var galaxyIndices: [Int] = []
                    galaxyIndices.append(rowIndex)
                    galaxyIndices.append(columnIndex)
                    allGalaxies.append(galaxyIndices)
                }
            }
        }
                
        print(allGalaxies.count)
        
        for (galaxyNumber, galaxyIndices) in allGalaxies.enumerated() {
            guard galaxyNumber != (allGalaxies.count - 1) else { break }
            
            for nextGalaxyIndices in allGalaxies[(galaxyNumber + 1)...(allGalaxies.count - 1)] {
                let galaxyRowIndex = galaxyIndices[0]
                let galaxyColumnIndex = galaxyIndices[1]
                
                let nextGalaxyRowIndex = nextGalaxyIndices[0]
                let nextGalaxyColumnIndex = nextGalaxyIndices[1]

                var numberOfBlackHolesCrossing: Int = 0
        
                for emptyRowIndex in emptyRowsIndices {
                    if galaxyRowIndex <= nextGalaxyRowIndex {
                        if galaxyRowIndex < emptyRowIndex && emptyRowIndex < nextGalaxyRowIndex {
                            numberOfBlackHolesCrossing += 1
                        }
                    } else {
                        if galaxyRowIndex > emptyRowIndex && emptyRowIndex > nextGalaxyRowIndex {
                            numberOfBlackHolesCrossing += 1
                        }
                    }
                }
                
                for emptyColumnIndex in emptyColumnsIndices {
                    if galaxyColumnIndex <= nextGalaxyColumnIndex {
                        if galaxyColumnIndex < emptyColumnIndex && emptyColumnIndex < nextGalaxyColumnIndex {
                            numberOfBlackHolesCrossing += 1
                        }
                    } else {
                        if galaxyColumnIndex > emptyColumnIndex && emptyColumnIndex > nextGalaxyColumnIndex {
                            numberOfBlackHolesCrossing += 1
                        }
                    }
                }
                
                var verticalyFar: Int = abs(nextGalaxyIndices[0] - galaxyIndices[0])
                var horizontalyFar: Int = abs(nextGalaxyIndices[1] - galaxyIndices[1])
                
                var length: Int = horizontalyFar + verticalyFar - numberOfBlackHolesCrossing + (numberOfBlackHolesCrossing * multiplyerOfTheEmtyRowOrColumn)
                sum += length
            }
        }
        
        return sum
    }
}

//CosmicExpansion2().sumOfShortestWays(input: CosmicExpansion2().shortInput, multiplyerOfTheEmtyRowOrColumn: 10) // Right answer: 1030
//CosmicExpansion2().sumOfShortestWays(input: CosmicExpansion2().shortInput, multiplyerOfTheEmtyRowOrColumn: 100) // Right answer: 8410

CosmicExpansion2().sumOfShortestWays(input: CosmicExpansion2().longInput, multiplyerOfTheEmtyRowOrColumn: 1000000) // Right answer: 504715068438
